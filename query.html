<!DOCTYPE html>
<html>
<title>
    GeNA Miner
</title>
<head>
<script src="static/js/jquery.min.js"></script>

<script src="static/js/jquery.cookie.js"></script>

<script src="static/js/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="static/css/bootstrap.min.css">
<!--<link rel="stylesheet" type="text/css" href="static/css/bootstrap-theme.min.3.2.0.css">-->

<link rel="stylesheet" type="text/css" href="static/css/font-awesome.min.css">

<script src="static/js/jquery.bootstrap-growl.min.js"></script>

<script src="static/js/bootbox.js"></script>

<script src="static/js/jquery.dataTables.min.js"></script>
<!--<link rel="stylesheet" type="text/css" href="static/css/jquery.dataTables.css">-->

<script src="static/js/dataTables.bootstrap.js"></script>
<link rel="stylesheet" type="text/css" href="static/css/dataTables.bootstrap.css">

<script src="static/js/dataTables.fixedHeader.js"></script>
<link rel="stylesheet" type="text/css" href="static/css/dataTables.fixedHeader.css">

<script src="static/js/main.js"></script>
<link rel="stylesheet" type="text/css" href="static/css/main.css">

<script type="text/javascript" class="init">
$(document).ready(function() {
    $.getJSON("hosts.json", function(hosts) {
        var host = hosts[0]["host"];

        var table = $("#example").DataTable( {
            "ajax": {
                "url": "http://" + host + "/history/load",
                "dataType": "jsonp",
                "jsonpCallback": "jsonpcallback",
            },

            "deferRender": true,
            "paging": false, 
            "searching": false,
            "ordering": false,

            "columns": [
                { 
                    "width": "50%", 
                    "data": "query",
                    "orderable": false
                },
                {
                    "width": "50%", 
                    "data": "stat",
                    "orderable": false 
                }
            ]
        });

        $('#example tbody').on('click', 'tr', function () {
            table.$('tr.active').removeClass("active");
            $(this).addClass('active');

            $("#query").val(table.row(".active").data()["query"]);
        });

        $("input[name='host']").val(host);

        $('#from').val(1900);
        $('#to').val(new Date().getFullYear() - 1);

        $('#to').attr("title", $('#to').attr("title") + (new Date().getFullYear() - 1).toString() + " (last year)");

        $("[title]").attr("data-placement", "bottom").tooltip({html: true, container: 'body'});

        $("#query").on("input", function() {
            if (this.value !== table.$("tr.active").val()) {
                table.$('tr.active').removeClass('active');
            }
        });

        $('#query_form').submit( function(e) {
            if (!isNotEmpty($('#query').val())) {
                showAlert("Please check your inputs.", "danger");
                $("#query").tooltip("show");
                $("#query_form").addClass("has-error");
                e.preventDefault();
                return;
            }
            else {
                $("#query").tooltip("hide");
            }
            if (!isIntWithMinVal($('#from').val(), 1900)) {
                showAlert("Please check your inputs.", "danger");
                $("#from").tooltip("show");
                $("#query_form").addClass("has-error");
                e.preventDefault();
                return;
            }
            if (!isIntWithMaxVal($('#to').val(), new Date().getFullYear() - 1)) {
                showAlert("Please check your inputs.", "danger");
                $("#to").tooltip("show");
                $("#query_form").addClass("has-error");
                e.preventDefault();
                return;
            }
        } );
        new $.fn.dataTable.FixedHeader( table );

        var dateRegex = /\b(?:jan|feb|mar|apr|may|jun|jul|aug|sept?|oct|nov|dec)\s+\d{1,2}\s*(?:st|nd|rd|th)?\s*,?\s+\d{4}\b/i;
        $.ajax({
            dataType: "html",
            cache: true,
            url: "updates.html", 
            success: function(j) {
                var updateHtml = j;
                var updateDate = dateRegex.exec(updateHtml);
                var updateCookieName = "updated_" + updateDate.toString().toLowerCase();

                if (!$.cookie(updateCookieName)) {
                    showUpdates(updateDate, updateHtml);
                    $.cookie(updateCookieName, 'true');
                }
                $("#updates").click(function() {
                    showUpdates(updateDate, updateHtml);
                });
            }
        });
        function showUpdates(date, html) {
            bootbox.dialog({
                message: html,
                title: "Updates",
                closeButton: false,
                buttons: {
                    ok: {
                        label: "<span class=\"glyphicon glyphicon-heart\"></span> Got It",
                        className: "btn-success"
                    }
                }
            });
        }

        $("#about").click(function() {
            $.ajax({
                dataType: "html",
                cache: true,
                url: "about.html", 
                success: function(html) {
                    bootbox.dialog({
                        message: html,
                        title: "About",
                        onEscape: function() {},
                        buttons: {
                            ok: {
                                label: "OK",
                                className: "btn-default"
                            }
                        }
                    });
                }
            });

        });
    });
});
</script>
</head>
<body>
<div class="beta-ribbon-wrapper"><div class="beta-ribbon"><a href="http://www.genalab.org/">GeNA Lab</a></div></div>
<div class="main" style="margin-top:36px;">
    <h3>GeNA Miner <small>-- From GeNA Lab</small></h3>
<div style="width:50%;">
    <div class="block">
        <form class="form-inline" id="query_form" action="main.html" method="get">
            <input type="hidden" name="host"></input>
            <label class="control-label">Query: </label>
            <input class="form-control input-sm" id="query" style="width:200px;" name="query" title="At least one keyword"></input>
            <label class="control-label">Year: </label>
            <input class="form-control input-sm" id="from" style="width:50px;" maxlength="4" name="from" title="Greater than or equal to 1900"></input> - <input class="form-control input-sm" id="to" style="width:50px;" maxlength="4" name="to" title="Less than or equal to "></input>
            <button class="btn btn-primary btn-sm" id="load" type="submit"><span class="glyphicon glyphicon-search"></span> Search</button>
        </form>
    </div>
    <div class="block">
        <label class="control-label">Indexed Query: </label>
        <table id="example" class="table table-hover" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th>Query</th>
                    <th>Indexed</th>
                </tr>
            </thead>

        </table>
    </div>
    <div style="padding: 10px;">
        <table id="form_table" style="width:100%; ">
            <col width="60%">
            <col width="40%">
            <tr>
                <td>
                    <button class="btn btn-success btn-xs" id="about"><span class="glyphicon glyphicon-user"></span> About</button>
                    <button class="btn btn-info btn-xs" id="updates"><span class="glyphicon glyphicon-wrench"></span> Updates</button>
                </td>
                <td align="right">
                    Â© GeNA Lab
                </td>
            </tr>
        </table>
    </div>
</div>

</div>
</body>
</html>

